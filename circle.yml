general:
  artifacts:
  #  - /var/log/upstart/docker.log
machine:
  services:
    - docker
  post:
    - pyenv global 3.5.0
dependencies:
  post:
    # Check which image we're using
    - ls -lah
    - ls -lah ~
    - docker build --rm=false -t felicianotech/go-sample-webapp:$CIRCLE_SHA1 .
    - docker run felicianotech/go-sample-webapp:$CIRCLE_SHA1
    - docker exec felicianotech/go-sample-webapp:$CIRCLE_SHA1 /opt/circleci-testing
    - sudo lxc-attach -n "$(docker inspect --format "{{.Id}}" felicianotech/go-sample-webapp:$CIRCLE_SHA1)" -- bash -c /opt/circleci-testing
  # - sudo rm /etc/apt/sources.list.d/google*
  # - sudo apt-get update
deployment:
  production:
    branch: master
    commands:
#      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      #- docker push felicianotech/go-sample-webapp:$CIRCLE_SHA1
#      - VARTEST=birthday env | grep VARTEST
      - ls -la
