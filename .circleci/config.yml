version: 2
jobs:
  build:
    docker:
      - image: circleci/golang:1.10
        environment:
          - TEST_VAR=chicken
          TEST_VAR2: pork
    environment:
      - TEST_VAR3: beef
    steps:
      - checkout
      - run:
          name: "Test Environment Values"
          command: echo $TEST_VAR; echo $TEST_VAR2; echo $TEST_VAR3
      - run:
          name: "Check Go Formatting"
          command: "! go fmt ./... 2>&1 | read"
      - run:
          name: "Set 40 second Build Time Limit"
          command: sleep 40; touch .fail-build; exit 1
          background: true
      - run: |
          sleep 20
          echo "Break 1"
          sleep 20
          echo "Break 2"
          #sleep 20
          #echo "Break 3"
          #sleep 20
          #echo "Break 4"
      - run:
          name: "This should never run."
          command: echo "Damn, I ran."
      - run:
          name: "Enforce Build Time Limit"
          command: if [ -f .fail-build ]; then echo "Build ran too long."; exit 1; fi
          when: always
